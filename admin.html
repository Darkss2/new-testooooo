<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel Test</title>
  <style>
    body{background:#0f172a;color:white;font-family:Arial;padding:20px;}
    input, button{width:100%;padding:8px;margin:5px;}
    .card{background:#111827;padding:10px;margin:10px 0;border-radius:10px;}
    button{background:#2563eb;color:white;border:none;border-radius:5px;cursor:pointer;}
  </style>
</head>
<body>

<h1>Admin Panel Test</h1>

<div id="loginForm">
  <input type="text" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button id="loginBtn">Login</button>
</div>

<div id="panel" style="display:none;">
  <h2>Add Product</h2>
  <input id="name" placeholder="Name">
  <input id="desc" placeholder="Description">
  <input id="price" type="number" placeholder="Price">
  <input id="stock" type="number" placeholder="Stock">
  <input id="image" placeholder="Image URL">
  <button id="addBtn">Add</button>

  <h2>Products</h2>
  <div id="products"></div>
</div>

<script>
let token;
let products = [];

document.getElementById("loginBtn").addEventListener("click", login);
document.getElementById("addBtn").addEventListener("click", addProduct);

async function login() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  if (!email || !password) { alert("Enter email and password"); return; }

  try {
    const res = await fetch("/api/login", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ email, password })
    });

    if (res.status !== 200) { alert("Login failed"); return; }

    const data = await res.json();
    token = data.token;

    document.getElementById("loginForm").style.display = "none";
    document.getElementById("panel").style.display = "block";
    loadProducts();
  } catch(err) {
    alert("Error: " + err.message);
  }
}

async function loadProducts() {
  try {
    const res = await fetch("/api/get-products");
    const data = await res.json();
    products = data.products;
    document.getElementById("products").innerHTML = products.map(p=>`
      <div class="card">${p.name} | ${p.price} DZD | Stock: ${p.stock}</div>
    `).join("");
  } catch(err) {
    alert("Error loading products: " + err.message);
  }
}

async function addProduct() {
  const newProduct = {
    id: products.length ? Math.max(...products.map(p=>p.id))+1 : 1,
    name: document.getElementById("name").value,
    description: document.getElementById("desc").value,
    price: Number(document.getElementById("price").value),
    stock: Number(document.getElementById("stock").value),
    image: document.getElementById("image").value
  };

  products.push(newProduct);

  try {
    await fetch("/api/save-products", {
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({ products })
    });
    loadProducts();
  } catch(err) {
    alert("Error saving product: " + err.message);
  }
}
</script>

</body>
</html>
